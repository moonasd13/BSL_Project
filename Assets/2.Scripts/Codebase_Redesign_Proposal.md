# BSL 프로젝트 - 코드베이스 재설계 제안서

## 1. 현재 아키텍처 분석

### 1.1 핵심 구성 요소

1. **인벤토리 시스템**
   - `InventoryManager`: 인벤토리 상태와 아이템 관리
   - `InventorySlotDropHandler`: 드래그 앤 드롭 기능 처리
   - `ItemInfo`: 아이템 데이터와 그리드 정보 저장
   - `ItemManager`: 아이템 인스턴스와 동작 관리

2. **그리드 시스템**
   - `Grid`: 개별 인벤토리 슬롯 표현
   - `GridRayCheck`: 그리드 상호작용을 위한 레이캐스팅 처리
   - `EmptyCheck`: 그리드 공간 사용 가능 여부 검증

3. **게임 오브젝트**
   - `PlayerController`: 플레이어 이동 및 상호작용 처리
   - `MonsterController`: 몬스터 행동 관리
   - `ItemSpawner`: 게임 내 아이템 생성 처리

### 1.2 주요 문제점

1. **높은 결합도**
   - 컴포넌트 간 직접적인 의존성 (예: `InventorySlotDropHandler`가 다른 컴포넌트들을 직접 참조)
   - `GetComponent<>()` 호출의 과도한 사용
   - 싱글톤을 통한 전역 상태 관리

2. **코드 중복**
   - 여러 파일에 걸친 유사한 로직의 반복
   - 일관되지 않은 네이밍 규칙
   - 드래그 앤 드롭 처리에서의 중복 코드

3. **아키텍처적 문제점**
   - UI와 게임 로직의 혼재
   - 인터페이스와 추상화의 제한적 사용
   - 일관성 없는 오류 처리

## 2. 제안된 재설계 방안

### 2.1 아키텍처 개선 사항

1. **MVC/MVVM 패턴 적용**
   - 데이터(Model), 프레젠테이션(View), 로직(Controller/ViewModel) 분리
   - UI와 게임 로직 간의 명확한 경계 설정

2. **의존성 주입**
   - 직접적인 컴포넌트 참조를 인터페이스로 대체
   - 테스트 용이성을 위한 DI 컨테이너 사용

3. **이벤트 기반 아키텍처**
   - 느슨한 결합을 위한 이벤트 시스템 구현
   - 직접적인 메서드 호출 대신 이벤트 사용

### 2.2 코드 구조

```
Assets/
├── Scripts/
│   ├── Core/
│   │   ├── Managers/
│   │   │   ├── GameManager.cs
│   │   │   └── UIManager.cs
│   │   ├── Events/
│   │   │   └── EventSystem.cs
│   │   └── Services/
│   │       └── ServiceLocator.cs
│   │
│   ├── Inventory/
│   │   ├── Models/
│   │   │   ├── Item.cs
│   │   │   └── Inventory.cs
│   │   ├── Views/
│   │   │   ├── InventoryView.cs
│   │   │   └── ItemView.cs
│   │   └── Controllers/
│   │       ├── InventoryController.cs
│   │       └── DragDropController.cs
│   │
│   ├── GridSystem/
│   │   ├── Grid.cs
│   │   ├── GridCell.cs
│   │   └── GridLayout.cs
│   │
│   └── Characters/
│       ├── Player/
│       └── Enemies/
```

### 2.3 주요 리팩토링 과제

1. **인벤토리 시스템**
   - 아이템과 인벤토리를 위한 적절한 인터페이스 생성
   - 인벤토리 업데이트를 위한 견고한 이벤트 시스템 구현
   - 드래그 앤 드롭 로직을 전용 컴포넌트로 분리

2. **그리드 시스템**
   - 재사용 가능한 일반적인 그리드 시스템 생성
   - AI를 위한 그리드 기반 경로찾기 구현
   - 저장/로드를 위한 그리드 직렬화 추가

3. **코드 품질**
   - 공개 API에 대한 XML 문서화 추가
   - 핵심 시스템에 대한 단위 테스트 구현
   - 적절한 오류 처리 및 로깅 추가

## 3. 구현 계획

### 1단계: 기반 구축 (1-2주)
1. 새 프로젝트 구조 설정
2. 핵심 시스템 구현 (EventSystem, ServiceLocator)
3. 기본 인터페이스와 추상 클래스 생성

### 2단계: 인벤토리 시스템 (2-3주)
1. 새 아키텍처를 사용한 인벤토리 시스템 리팩토링
2. 새로운 드래그 앤 드롭 시스템 구현
3. 인벤토리 기능에 대한 단위 테스트 추가

### 3단계: 그리드 시스템 (1-2주)
1. 그리드 시스템 리팩토링
2. 그리드 기반 이동 및 경로찾기 구현
3. 그리드 직렬화 추가

### 4단계: 다듬기 및 최적화 (1주)
1. 성능 최적화
2. 시각적 피드백 추가
3. 버그 수정 및 테스트

## 4. 기술적 부채와 위험 요소

### 4.1 기술적 부채
- 컴포넌트 간의 높은 결합도
- 단위 테스트 부족
- 일관성 없는 오류 처리
- 제한된 문서화

### 4.2 위험 요소와 완화 방안
| 위험 | 영향도 | 완화 방안 |
|------|--------|------------|
| 리팩토링으로 인한 기존 기능 손상 | 높음 | 단위 테스트를 먼저 구현하고 점진적으로 리팩토링 |
| 성능 문제 | 중간 | 변경 전후로 프로파일링 수행 |
| 개발 기간 연장 | 중간 | 작고 관리 가능한 작업으로 분할 |

## 5. 결론

이 재설계 제안은 현재의 아키텍처적 문제를 해결하면서 향후 개발을 위한 견고한 기반을 제공하기 위한 것입니다. 새로운 구조는 더 나은 유지보수성, 테스트 용이성, 확장성을 가질 것입니다. 단계적 접근 방식을 통해 기존 코드베이스에 대한 중단을 최소화하면서 점진적인 개선이 가능할 것입니다.
